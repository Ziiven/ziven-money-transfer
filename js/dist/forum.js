(()=>{var t={n:r=>{var n=r&&r.__esModule?()=>r.default:()=>r;return t.d(n,{a:n}),n},d:(r,n)=>{for(var e in n)t.o(n,e)&&!t.o(r,e)&&Object.defineProperty(r,e,{enumerable:!0,get:n[e]})},o:(t,r)=>Object.prototype.hasOwnProperty.call(t,r),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},r={};(()=>{"use strict";t.r(r);const n=flarum.core.compat.extend,e=flarum.core.compat["utils/UserControls"];var o=t.n(e);const s=flarum.core.compat["components/NotificationGrid"];var a=t.n(s);const i=flarum.core.compat["components/Button"];var u=t.n(i);function l(t,r){return l=Object.setPrototypeOf||function(t,r){return t.__proto__=r,t},l(t,r)}function f(t,r){t.prototype=Object.create(r.prototype),t.prototype.constructor=t,l(t,r)}const c=flarum.core.compat.Model;var p=t.n(c),y=function(t){function r(){return t.apply(this,arguments)||this}return f(r,t),r}(p());Object.assign(y.prototype,{id:p().attribute("id"),transferMoney:p().attribute("transfer_money_value"),assignedAt:p().attribute("assigned_at"),fromUser:p().hasOne("fromUser"),targetUser:p().hasOne("targetUser")});const d=flarum.core.compat["forum/app"];var h=t.n(d);const v=flarum.core.compat["components/Modal"];var g=t.n(v);const b=flarum.core.compat["common/components/Modal"];var x=t.n(b);const z=flarum.core.compat["common/components/Button"];var M=t.n(z),w=function(t){function r(){return t.apply(this,arguments)||this}f(r,t);var n=r.prototype;return n.oninit=function(r){t.prototype.oninit.call(this,r)},n.className=function(){return"Modal--small"},n.title=function(){return h().translator.trans("ziven-transfer-money.forum.transfer-money-success")},n.content=function(){return[m("div",{className:"Modal-body"},m("div",{style:"text-align:center"},M().component({style:"width:66px",className:"Button Button--primary",onclick:function(){location.reload()}},h().translator.trans("ziven-transfer-money.forum.ok"))))]},r}(x());w.isDismissible=!1;var N=function(t){function r(){return t.apply(this,arguments)||this}f(r,t);var n=r.prototype;return n.oninit=function(r){t.prototype.oninit.call(this,r)},n.className=function(){return"Modal--small"},n.title=function(){return h().translator.trans("ziven-transfer-money.forum.transfer-money-to",{user:this.attrs.user})},n.content=function(){var t=this,r=h().forum.attribute("antoinefr-money.moneyname")||"[money]";return m("div",{className:"Modal-body"},m("div",{className:"Form"},m("div",{className:"Form-group"},m("label",null,h().translator.trans("ziven-transfer-money.forum.current-money-amount")," ",r.replace("[money]",h().session.user.attribute("money"))),m("input",{id:"moneyTransferInput",required:!0,className:"FormControl",type:"number",step:"any",min:"0",value:"0"})),m("div",{className:"Form-group",style:"text-align: center;"},u().component({className:"Button Button--primary",type:"submit",loading:this.loading},h().translator.trans("ziven-transfer-money.forum.ok")),"Â ",u().component({className:"Button transferMoneyButton--gray",loading:this.loading,onclick:function(){t.hide()}},h().translator.trans("ziven-transfer-money.forum.cancel")))))},n.onsubmit=function(t){var r=this;t.preventDefault();var n=$("#moneyTransferInput").val(),e=this.attrs.user.id();if(n>0){var o={moneyTransfer:n,targetUserID:e};this.loading=!0,h().store.createRecord("transferMoney").save(o).then((function(t){h().store.pushPayload(t),h().modal.show(w),r.loading=!1})).catch((function(t){r.loading=!1}))}},r}(g());N.isDismissible=!1;const H=flarum.core.compat["components/Notification"];var _=function(t){function r(){return t.apply(this,arguments)||this}f(r,t);var n=r.prototype;return n.icon=function(){return"fas fa-money-bill"},n.href=function(){return h().route("user.transferHistory",{username:h().session.user.username()})},n.content=function(){var t=this.attrs.notification.fromUser();return h().translator.trans("ziven-transfer-money.forum.notifications.user-transfer-money-to-you",{user:t})},n.excerpt=function(){var t=this.attrs.notification.subject(),r=t.attribute("transfer_money_value"),n=t.attribute("id"),e=(h().forum.attribute("antoinefr-money.moneyname")||"[money]").replace("[money]",r);return h().translator.trans("ziven-transfer-money.forum.notifications.user-transfer-money-details",{cost:e,id:n})},r}(t.n(H)());const U=flarum.core.compat["components/UserPage"];var R=t.n(U);const k=flarum.core.compat["components/LinkButton"];var B=t.n(k);const O=flarum.core.compat.Component;var j=t.n(O);const P=flarum.core.compat.app;var T=t.n(P);const C=flarum.core.compat["components/LoadingIndicator"];var I=t.n(C);const S=flarum.core.compat["components/Link"];var D=t.n(S);const F=flarum.core.compat["helpers/avatar"];var L=t.n(F);const A=flarum.core.compat["helpers/username"];var q=t.n(A),G=function(t){function r(){return t.apply(this,arguments)||this}return f(r,t),r.prototype.view=function(){var t=this.attrs.transferHistory,r=app.session.user.id(),n=t.attribute("from_user_id"),e=t.assignedAt(),o=t.fromUser(),s=t.targetUser(),a=t.transferMoney(),i=t.id(),u=app.translator.trans(r==n?"ziven-transfer-money.forum.transfer-money-out":"ziven-transfer-money.forum.transfer-money-in"),l=r==n?"color:red":"color:green",f=(app.forum.attribute("antoinefr-money.moneyname")||"[money]").replace("[money]",a);return m("div",{className:"transferHistoryContainer"},m("div",{style:"display: flex;"},m("div",{style:"width:70px"},i),m("div",{style:"width:85px;"},m("span",{style:l},u)),m("div",{style:"width:190px"},m(D(),{href:o?app.route.user(o):"#",className:"transferHistoryUser",style:"color:var(--heading-color)"},L()(o)," ",q()(o))),m("div",{style:"width:190px"},m(D(),{href:s?app.route.user(s):"#",className:"transferHistoryUser",style:"color:var(--heading-color)"},L()(s)," ",q()(s))),m("div",{style:"width:190px"},e),m("div",{style:"width:85px"},f)))},r}(j()),E=function(t){function r(){return t.apply(this,arguments)||this}f(r,t);var n=r.prototype;return n.oninit=function(r){t.prototype.oninit.call(this,r),this.loading=!0,this.moreResults=!1,this.transferHistory=[],this.user=this.attrs.params.user,this.loadResults()},n.view=function(){var t=this;return this.loading&&I().component({size:"large"}),m("div",null,m("div",{style:"padding-bottom:30px; font-size: 24px;font-weight: bold;"},T().translator.trans("ziven-transfer-money.forum.transfer-money-history")),m("div",{style:"display: flex;font-weight: bold;font-size: 14px;padding-bottom:20px"},m("div",{style:"width:70px"},T().translator.trans("ziven-transfer-money.forum.transfer-list-id")),m("div",{style:"width:85px"},T().translator.trans("ziven-transfer-money.forum.transfer-list-type")),m("div",{style:"width:190px"},T().translator.trans("ziven-transfer-money.forum.transfer-list-from-user")),m("div",{style:"width:190px"},T().translator.trans("ziven-transfer-money.forum.transfer-list-target-user")),m("div",{style:"width:190px"},T().translator.trans("ziven-transfer-money.forum.transfer-list-assign-at")),m("div",{style:"width:85px"},T().translator.trans("ziven-transfer-money.forum.transfer-list-transfer-amount"))),m("ul",{style:"margin: 0;padding: 0;list-style-type: none;position: relative;"},this.transferHistory.map((function(t){return m("li",{key:t.id(),"data-id":t.id()},G.component({transferHistory:t}))}))),!this.loading&&0===this.transferHistory.length&&m("div",null,m("div",{style:"font-size:1.4em;color: var(--muted-more-color);text-align: center;height: 300px;line-height: 100px;"},T().translator.trans("ziven-transfer-money.forum.transfer-list-empty"))),this.hasMoreResults()&&m("div",{style:"text-align:center;padding:20px"},m(u(),{className:"Button Button--primary",disabled:this.loading,loading:this.loading,onclick:function(){return t.loadMore()}},T().translator.trans("ziven-transfer-money.forum.transfer-list-load-more"))))},n.loadMore=function(){this.loading=!0,this.loadResults(this.transferHistory.length).then(this.parseResults.bind(this))},n.parseResults=function(t){return this.moreResults=!!t.payload.links&&!!t.payload.links.next,[].push.apply(this.transferHistory,t),this.loading=!1,m.redraw(),t},n.hasMoreResults=function(){return this.moreResults},n.loadResults=function(t){return void 0===t&&(t=0),T().store.find("transferHistory",{filter:{user:this.user.id()},page:{offset:t}}).catch((function(){})).then(this.parseResults.bind(this))},r}(j()),J=function(t){function r(){return t.apply(this,arguments)||this}f(r,t);var n=r.prototype;return n.oninit=function(r){t.prototype.oninit.call(this,r),this.loadUser(m.route.param("username"))},n.content=function(){return m("div",{className:"TransferHistoryPage"},E.component({params:{user:this.user}}))},r}(R());app.initializers.add("ziven-money-transfer",(function(){app.store.models.transferMoney=y,app.notificationComponents.transferMoney=_,app.routes["user.transferHistory"]={path:"/u/:username/transferHistory",component:J},(0,n.extend)(R().prototype,"navItems",(function(t,r){app.session.user.id()==this.user.id()&&t.add("transferMoney",B().component({href:app.route("user.transferHistory",{username:this.user.username()}),icon:"fas fa-money-bill"},[app.translator.trans("ziven-transfer-money.forum.transfer-money-history")]),10)})),(0,n.extend)(a().prototype,"notificationTypes",(function(t){t.add("transferMoney",{name:"transferMoney",icon:"fas fa-dollar-sign",label:app.translator.trans("ziven-transfer-money.forum.receive-transfer-from-user")})})),(0,n.extend)(o(),"moderationControls",(function(t,r){var n=app.forum.attribute("allowUseTranferMoney");app.session.user&&n&&app.session.user.id()!==r.id()&&t.add("transferMoney",u().component({icon:"fas fa-money-bill",onclick:function(){return app.modal.show(N,{user:r})}},app.translator.trans("ziven-transfer-money.forum.transfer-money")))}))}))})(),module.exports=r})();
//# sourceMappingURL=forum.js.map